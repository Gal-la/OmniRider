#include <SoftwareSerial.h>
#include <AccelStepper.h>

SoftwareSerial Bluetooth(10, 11);    // CONFIGURACIÓ BLUETOOTH
#define EN_PIN 8                     // Enable pin comú a tots els DRV8825
int wheelSpeed = 1000;               // CONFIGURACIÓ DE LA VELOCITAT
int m;                               // Variable on guardar el valor rebut per a la antena bluetooth

AccelStepper RodaPosteriorEsquerra(AccelStepper::DRIVER, 2, 5);     // X: STEP=2, DIR=5
AccelStepper RodaDavanteraEsquerra(AccelStepper::DRIVER, 3, 6);     // Y: STEP=3, DIR=6
AccelStepper RodaPosteriorDreta(AccelStepper::DRIVER, 4, 7);        // Z: STEP=4, DIR=7
AccelStepper RodaDavanteraDreta(AccelStepper::DRIVER, 12, 13);      // A: STEP=12, DIR=13

void setup() {
  // Inicialitza motors
  RodaDavanteraEsquerra.setMaxSpeed(3000);
  RodaPosteriorEsquerra.setMaxSpeed(3000);
  RodaDavanteraDreta.setMaxSpeed(3000);
  RodaPosteriorDreta.setMaxSpeed(3000);

  // Activa sortides
  pinMode(EN_PIN, OUTPUT);
  digitalWrite(EN_PIN, LOW); // LOW => motors actius

  // Bluetooth
  Bluetooth.begin(9600);
}

void loop() {
  // Lectura Bluetooth  
  if (Bluetooth.available() > 0) {
    m = Bluetooth.read();

    switch (m) {
      case 65: Pausa(); break;                // A
      case 66: Davant(); break;               // B
      case 67: Endarrere(); break;            // C
      case 68: Dreta(); break;                // D
      case 69: Esquerra(); break;             // E
      case 70: DiagonalDavantE(); break;      // F
      case 71: DiagonalDavantD(); break;      // G
      case 72: DiagonalEndarrereE(); break;   // H
      case 73: DiagonalEndarrereD(); break;   // I
      case 74: GirarEsquerra(); break;        // J
      case 75: GirarDreta(); break;           // K
    }
  }

  // Actualitzar motors
  RodaDavanteraEsquerra.runSpeed();
  RodaPosteriorEsquerra.runSpeed();
  RodaDavanteraDreta.runSpeed();
  RodaPosteriorDreta.runSpeed();
}

// FUNCIONS DELS MOVIMENTS  
void Pausa() {                                  //A
  RodaDavanteraEsquerra.setSpeed(0);
  RodaPosteriorEsquerra.setSpeed(0);
  RodaDavanteraDreta.setSpeed(0);
  RodaPosteriorDreta.setSpeed(0);
}
void Davant() {                                 //B
  RodaDavanteraEsquerra.setSpeed(-wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(-wheelSpeed);
  RodaDavanteraDreta.setSpeed(wheelSpeed);
  RodaPosteriorDreta.setSpeed(wheelSpeed);
}
void Endarrere() {                              //C
  RodaDavanteraEsquerra.setSpeed(wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(wheelSpeed);
  RodaDavanteraDreta.setSpeed(-wheelSpeed);
  RodaPosteriorDreta.setSpeed(-wheelSpeed);
}
void Dreta() {                                  //D
  RodaDavanteraEsquerra.setSpeed(-wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(wheelSpeed);
  RodaDavanteraDreta.setSpeed(-wheelSpeed);
  RodaPosteriorDreta.setSpeed(wheelSpeed);
}
void Esquerra() {                               //E
  RodaDavanteraEsquerra.setSpeed(wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(-wheelSpeed);
  RodaDavanteraDreta.setSpeed(wheelSpeed);
  RodaPosteriorDreta.setSpeed(-wheelSpeed);
}
void DiagonalDavantE() {                        //F
  RodaDavanteraEsquerra.setSpeed(0);
  RodaPosteriorEsquerra.setSpeed(-wheelSpeed);
  RodaDavanteraDreta.setSpeed(wheelSpeed);
  RodaPosteriorDreta.setSpeed(0);
}
void DiagonalDavantD() {                        //G
  RodaDavanteraEsquerra.setSpeed(-wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(0);
  RodaDavanteraDreta.setSpeed(0);
  RodaPosteriorDreta.setSpeed(wheelSpeed);
}
void DiagonalEndarrereE() {                     //H
  RodaDavanteraEsquerra.setSpeed(wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(0);
  RodaDavanteraDreta.setSpeed(0);
  RodaPosteriorDreta.setSpeed(-wheelSpeed);
}
void DiagonalEndarrereD() {                     //I
  RodaDavanteraEsquerra.setSpeed(0);
  RodaPosteriorEsquerra.setSpeed(wheelSpeed);
  RodaDavanteraDreta.setSpeed(-wheelSpeed);
  RodaPosteriorDreta.setSpeed(0);
}
void GirarEsquerra() {                          //J
  RodaDavanteraEsquerra.setSpeed(wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(wheelSpeed);
  RodaDavanteraDreta.setSpeed(wheelSpeed);
  RodaPosteriorDreta.setSpeed(wheelSpeed);
}
void GirarDreta() {                             //K
  RodaDavanteraEsquerra.setSpeed(-wheelSpeed);
  RodaPosteriorEsquerra.setSpeed(-wheelSpeed);
  RodaDavanteraDreta.setSpeed(-wheelSpeed);
  RodaPosteriorDreta.setSpeed(-wheelSpeed);
}

